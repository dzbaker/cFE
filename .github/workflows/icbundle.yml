name: Integration Candidate Bundle Generation

# Generate Integration Candidate branch for this repository.

on:
  workflow_dispatch:
    inputs:
      pr_nums:
        description: 'The pull request numbers to include (Comma separated)'
        required: true
        type: string

jobs:
  generate-ic-bundle:
    runs-on: ubuntu-latest
    steps:
      - name: Install Dependencies
        run: |
          sudo apt update
          sudo apt install -y w3m
      - name: Checkout IC Branch
        uses: actions/checkout@v3
        with:
          fetch-depth: '0'
          ref: main
      - name: Rebase IC Branch
        run: |
          git config user.name "GitHub Actions"
          git config user.email "cfs-program@list.nasa.gov"
          git pull
          git checkout integration-candidate
          git rebase main
      - name: Merge each PR
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          prs=$(echo ${{ inputs.pr_nums }} | tr "," "\n")
          for pr in $prs
          do
            hub pr show -f %H $pr
            git fetch origin pull/$pr/head:origin/pull/$pr/head
            git merge origin/pull/$pr/head --no-ff -m "Merge pull request #$pr from branch\n\nmessage"
          done
          git log
